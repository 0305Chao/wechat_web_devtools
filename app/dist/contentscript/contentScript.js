'use strict';var ua=navigator.userAgent,webviewID=parseInt(ua.match(/webview\/(\d*)/)[1]),weapp=ua.match(/weapp\/(\d*)/),weappID=weapp?parseInt(weapp[1]):void 0;window.runtime={};var portInit=!1,postMessageInit=!1,portMsgQuery=[],postMessageQuery=[],port=window.runtime.port=chrome.runtime.connect('',{name:`webview${webviewID}`}),__msgQueue={},__id=0;function postMessageToNW(a){if(a.webviewID=webviewID,a.weappID=weappID,!portInit)return void portMsgQuery.push(a);for(__msgQueue[a.__id]=a;__msgQueue[__id];)port.postMessage(__msgQueue[__id]),delete __msgQueue[__id],__id++}function postMessageToWebPage(a){return postMessageInit?void(a.webviewID=webviewID,window.postMessage(a,'*')):void postMessageQuery.push(a)}let showProxyErr=!1;function handleMsg(a){let b=a.command;if('SHAKE_HANDS'===b)portInit=!0,portMsgQuery.length&&(portMsgQuery.forEach(c=>{postMessageToNW(c)}),portMsgQuery=[]);else if('ERR_CONNECTION_RESET'===b&&!showProxyErr){let c=a.msg,d=`因为网络代理软件或者 VPN 影响，工具无法加载本地模拟开发服务 ${c.url} 请尝试以下任一解决方案
1.关闭相关网络代理软件，重新编译成功后，再启动相关网络代理软件；
2.配置相关软件不针对 *.appservice.open.weixin.qq.com 和 *.debug.open.weixin.qq.com 进行代理；
3.配置相关软件不针对 开发者工具 做代理。`;console.group(`${new Date} 工具加载错误`),console.error(d),console.groupEnd(),showProxyErr=!0}else if('SHOW_SYS_INFO'===b){let c=a.msg,d=c.memory,e=c.restartInfo,f=+new Date-e.projectBeginTime,g=e.projectRestartNum;console.group(`${new Date} 工具系统信息`),console.info(`工具已运行 ${(f/1000).toFixed(2)} 秒，执行编译 ${g} 次， 当前内存占用 ${d.toFixed(2)}m`),console.table(c.info),console.groupEnd()}}function receiveMessageFromPageFrame(a){'backgroundjs'===a.to&&postMessageToNW(a)}port.onMessage.addListener(a=>{let b=a.to;'contentscript'===b?handleMsg(a):'webframe'===b?postMessageToWebPage(a):'appservice'===b&&postMessageToWebPage(a)}),window.addEventListener('message',a=>{let b=a.data;if(b&&'object'==typeof b&&b.webviewID===webviewID){let i=b.comefrom,j=b.to;if('webframe'===i){let k=b.command;'contentscript'===j&&'SHAKE_HANDS'===k?(postMessageInit=!0,postMessageQuery.length&&(postMessageQuery.forEach(l=>{postMessageToWebPage(l)}),postMessageQuery=[])):receiveMessageFromPageFrame(b)}}});