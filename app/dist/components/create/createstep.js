'use strict';var _exports;function init(){function a(n){k.showTipsMsg({msg:n,type:'error'})}const b=require('../../lib/react.js');require('../../utils/tools.js');const c=require('../../cssStr/cssStr.js');require('path');const d=require('../../utils/newReport.js'),e=require('../../config/urlConfig.js'),f=require('../../common/request/request.js');require('../../stores/webviewStores.js');const g=require('../../common/log/log.js'),h=require('glob'),{DEV_Invalid_Appid:i,DEV_App_Not_Band:j}=require('../../config/errcodeConfig.js'),k=require('../../actions/windowActions.js');require('../../stores/projectStores.js');const l=require('../../actions/projectActions.js'),m=b.createClass({displayName:'Createstep',getInitialState:function(){return{projectpath:'',appid:'',appname:'',error:'',saveBtnDisable:!0,showQuickStart:!1,checked:!0,showLoading:!1,isTourist:!1}},chooseDir:function(){let n=document.createElement('input');n.setAttribute('type','file'),n.setAttribute('nwdirectory',!0),n.style.display='none',global.contentDocumentBody.appendChild(n),n.addEventListener('change',o=>{h('*',{cwd:n.value},(p,q)=>{let r=0===q.length;this.setState({projectpath:n.value,showQuickStart:r})}),global.contentDocumentBody.removeChild(n)}),n.addEventListener('cancel',o=>{global.contentDocumentBody.removeChild(n)}),n.click()},editAppid:function(n){let o=n.target,p=o.value;this.setState({appid:p})},editAppname:function(n){let o=n.target,p=o.value;this.setState({appname:p})},tourist:function(){this.setState({isTourist:!this.state.isTourist})},addProject:function(){let n=this.state.projectpath,o=this.state.isTourist,p=o?'touristappid':this.state.appid,q=encodeURIComponent(this.state.appname);if(!p)return void a(`请填写 appid `);if(!q)return void a(`请填写 项目名称 `);if(!n)return void a(`请选择 项目目录 `);let r=`${p}_${q}`,s=this.props.projectLists.find(v=>{return v.projectid===r});if(s)return void this.setState({projectpath:'',appid:'',appname:'',saveBtnDisable:!0,error:`已存在 ${p} ${decodeURIComponent(s.appname)} 项目，请重新输入`});let t=this.state.showQuickStart&&this.state.checked;this.setState({showLoading:!0});let u={projectpath:'',appid:'',appname:'',error:'',saveBtnDisable:!0,showLoading:!1,isTourist:!1};if(o){let v={appid:p,appname:q,projectpath:n,projectid:r,app_head_img:'',is_admin:!1,isTourist:!0,urlCheck:!1};l.add(v,t),d(`project_createsuc`,p),this.setState(u),this.props.goMain(v),f({url:`${e.touristCreateURL}?appid=${p}`,needToken:1},()=>{})}else f({url:`${e.createWeappURL}?appid=${p}`,needToken:1},(v,w,x)=>{if(v)g.error(`createstep.js create  ${v.toString()}`),this.setState({showLoading:!1}),a(v.toString());else{this.setState({showLoading:!1}),g.info(`createstep.js create  ${x}`);let y=JSON.parse(x),z=y.baseresponse,A=z?parseInt(z.errcode):0;if(A===j)return a('\u5F53\u524D\u5F00\u53D1\u8005\u672A\u7ED1\u5B9A\u6B64 AppID \uFF0C\u8BF7\u5230\u5C0F\u7A0B\u5E8F\u7BA1\u7406\u540E\u53F0\u64CD\u4F5C\u540E\u91CD\u8BD5'),nw.Shell.openExternal('https://mp.weixin.qq.com/'),void g.error(`createstep.js create project error ${A}`);if(A===i)return void a('\u4E0D\u5B58\u5728\u6B64 AppID \u8BF7\u68C0\u67E5\u540E\u91CD\u65B0\u8F93\u5165\u6216\u4F7F\u7528\u65E0 AppID \u6A21\u5F0F');if(0===A){let B=y.app_head_img?`${y.app_head_img}/0`:'',C=y.app_nickname||q;return s={appid:p,appname:q,projectpath:n,projectid:r,app_head_img:B,app_nickname:C,is_admin:y.is_admin,isTourist:!1,urlCheck:!0},l.add(s,t),d(`project_createsuc`,p),this.setState(u),void this.props.goMain(s)}a(x||'\u7CFB\u7EDF\u9519\u8BEF')}})},changeCheckbox:function(n){let o=n.target.checked;this.setState({checked:o})},render:function(){let n=this.props.show?{}:c.displayNone,o=this.state.showQuickStart?{}:c.visibilityHidden,p=this.props.createBack,q=this.state.isTourist,r=q?'\u65E0 AppID \u90E8\u5206\u529F\u80FD\u53D7\u9650':this.state.appid,s=q?'':'\u586B\u5199\u5C0F\u7A0B\u5E8FAppID ',t=q?'\u8FD4\u56DE\u586B\u5199\u5C0F\u7A0B\u5E8FAppID':'\u65E0 AppID ',u=this.state.showLoading?'create-form-button-primary detail-upload-dialog-button-primary-loading':'create-form-button-primary';return b.createElement('div',{className:'create-step2',style:n},b.createElement('div',{className:'create-toolbar app-drag'},b.createElement('a',{onClick:p,href:'javascript:;',className:'create-toolbar-close app-no-drag'},b.createElement('i',{className:'create-toolbar-back-icon'}),b.createElement('span',null,'\u8FD4\u56DE'))),b.createElement('div',{className:'create-body'},b.createElement('div',{className:'create-name'},'\u6DFB\u52A0\u9879\u76EE'),b.createElement('div',{className:'create-form'},b.createElement('div',{className:'create-form-item'},b.createElement('label',{htmlFor:'',className:'create-form-label'},'AppID'),b.createElement('div',{className:'create-form-input-box'},b.createElement('input',{value:r,onChange:this.editAppid,type:'text',className:'create-form-input',disabled:q}),b.createElement('p',{style:this.state.error?c.displayNone:{},className:'create-form-tips'},s,b.createElement('a',{onClick:this.tourist,href:'javascript:;',className:'create-form-tourist'},t)),b.createElement('p',{style:this.state.error?{}:c.displayNone,className:'create-form-tips-warn'},this.state.error))),b.createElement('div',{className:'create-form-item'},b.createElement('label',{htmlFor:'',className:'create-form-label'},'\u9879\u76EE\u540D\u79F0'),b.createElement('div',{className:'create-form-input-box'},b.createElement('input',{value:this.state.appname,onChange:this.editAppname,type:'text',className:'create-form-input'}))),b.createElement('div',{className:'create-form-item'},b.createElement('label',{htmlFor:'',className:'create-form-label'},'\u9879\u76EE\u76EE\u5F55'),b.createElement('div',{onClick:this.chooseDir,className:'create-form-input-box'},b.createElement('input',{value:this.state.projectpath,disabled:'true',type:'text',className:'create-form-input create-form-input-with-pointer'}),b.createElement('p',{className:'create-form-tips'})),b.createElement('div',{className:'create-form-extra'},b.createElement('a',{href:'javascript:;',onClick:this.chooseDir,className:'create-form-extra-button'},'\u9009\u62E9'))),b.createElement('div',{style:o,className:'create-quick-checkbox'},b.createElement('input',{id:'quick-checkbox',onChange:this.changeCheckbox,checked:this.state.checked,type:'checkbox'}),b.createElement('label',{htmlFor:'quick-checkbox'},'\u5728\u5F53\u524D\u76EE\u5F55\u4E2D\u521B\u5EFA quick start \u9879\u76EE'))),b.createElement('div',{className:'create-form-footer'},b.createElement('a',{href:'javascript:;',className:'create-form-button-default',onClick:p},'\u53D6\u6D88'),b.createElement('a',{onClick:this.addProject,href:'javascript:;',className:u},'\u6DFB\u52A0\u9879\u76EE'))))}});_exports=m}init(),module.exports=_exports;