'use strict';!function(require,directRequire){function a(a,b){if(!1!==x.md5){let c=x.libs[y][a],d=p.createHash('md5');d.update(b);let e=d.digest('hex');if(c!==e){let b=new Error(`${y} ${a} ${e}!=${c}`);throw b.code=m.VENDOR_MD5_NOT_MATCH,b}}}function b(a,b){if(!1!==x.md5){let c=x[a],d=p.createHash('md5');d.update(b);let e=d.digest('hex');if(c!==e){let b=new Error(`${a} ${e}!=${c}`);throw b.code=m.VENDOR_MD5_NOT_MATCH,b}}}function c(){x=C;let a=JSON.stringify(C);i.writeFileSync(v,a),y=x.currentLibVersion,w.emit('VENDOR_VERSION_CHANGE',x)}function d(){try{for(let a in t){let b=j.join(u,a),c=i.readFileSync(j.join(B,a));t[a]?i.writeFileSync(b,c,{mode:511}):i.writeFileSync(b,c)}c()}catch(a){k.error(`copyUnVersionVendor catch error ${a}`)}}async function e(a){let b=z[a];return b?b:(b=z[a]=i.readFileSync(j.join(B,a)),i.writeFile(destFilePath,b,(a)=>{a&&k.error(`getUnVersionVendorCache writeFile error ${a}`)}),b)}async function f(b){let c=z[y];if(!c)z[y]={};else if(c[b])return c[b];let d,e=j.join(u,y),f=j.join(e,b);try{return d=z[y][b]=i.readFileSync(f),'dev'!=y&&a(b,d),d}catch(a){k.error(`getVersionVendorCache catch error ${a}`)}n.sync(e);try{let a=j.join(B,y,b);return d=z[y][b]=i.readFileSync(a,'utf8'),i.writeFile(f,d,(a)=>{a&&k.error(`getVersionVendorCache writeFile ${y}/${b} error ${a}`)}),d}catch(a){k.error(`getVersionVendorCache from install package catch error ${a}`)}let h=`https://dldir1.qq.com/WechatWebDev/vendor/${y}/${b}`;return d=z[y][b]=await g(h),i.writeFile(f,d,(a)=>{k.error(`getVersionVendorCache writeFile ${y}/${b} error ${a}`)}),d}async function g(a){let b=await o({url:a,needToken:-1,needParse:-1});return b.body}function h(a){if(z[a])return z[a];let d=s?a:`${a}.exe`;if(r&&!nw.App.manifest.forceVendor)return z[a]=j.join(B,d),z[a];let e=j.join(u,d);if(i.existsSync(e))try{return b(d,i.readFileSync(e)),z[a]=e,e}catch(a){k.error(`getParsePath catch error ${a}`)}if(e=j.join(B,d),!i.existsSync(e)){let b=new Error(`${a} file not found in install package`);throw b.code='wcc'==a?m.VENDOR_WCC_FILE_NOT_FOUND:m.VENDOR_WCSC_FILE_NOT_FOUND,b}z[a]=e;try{i.writeFileSync(j.join(u,d),i.readFileSync(e),{mode:511}),c()}catch(a){}return e}const i=require('fs'),j=require('path'),k=require('./72653d4b93cdd7443296229431a7aa9a.js'),l=require('./92320c1386e6db6a6f2556736a9bc280.js'),m=require('./949d8235c744ced2a80121e4dba34c28.js'),n=require('mkdir-p'),o=require('./15ba1827c7f6564a45df6bd44da3a977.js'),p=require('crypto'),q=require('events').EventEmitter,r=global.appConfig.isDev,s='darwin'===process.platform;let t=s?{wcc:!0,wcsc:!0,DevToolProtector:!0}:{"wcc.exe":!0,"wcsc.exe":!0};t=Object.assign(t,{"hls.js":!1,"WARemoteDebug.js":!1,"devtools-native-components.js":!1});const u=l.WeappVendor,v=j.join(u,'config.json'),w=new q;let x,y,z={};const A=j.join(__dirname,'../../vendor/dev'),B=r?j.join(__dirname,'../../vendor/'):j.join(__dirname,'./vendor/'),C=JSON.parse(i.readFileSync(j.join(B,'config.json'),'utf8'));(function(){try{if(x=JSON.parse(i.readFileSync(v,'utf8')),x.configVersion>=C.configVersion)return void(y=x.currentLibVersion)}catch(a){k.error(`init catch error ${a}`)}d()})(),module.exports={on:function(a,b){w.on(a,b)},off:function(a,b){w.removeListener(a,b)},getFile:async function(a){return r&&!nw.App.manifest.forceVendor?i.readFileSync(j.join(A,a),'utf8'):t.hasOwnProperty(a)?e(a):f(a)},setVersion:function(a){return x.libs[a]?y!=a&&(y=a,w.emit('VENDOR_VERSION_CHANGE',a)):y!=x.currentLibVersion&&(y=x.currentLibVersion,w.emit('VENDOR_VERSION_CHANGE',a)),y},getVersion:function(){return y},getVendorConfig:function(){return x},getWXMLParsePath:function(){return h('wcc')},getWXSSParsePath:function(){return h('wcsc')},getFixpreferencesPath:function(){if(!s)return;if(z.DevToolProtector)return z.DevToolProtector;let a='DevToolProtector';if(r)return z.DevToolProtector=j.join(B,a),z.DevToolProtector;let b=j.join(u,a);if(!i.existsSync(b)&&(b=j.join(B,a),!i.existsSync(b))){let a=new Error('DevToolProtector file not found in install package');throw a.code=m.VENDOR_WCC_FILE_NOT_FOUND,a}return z.DevToolProtector=b,b},updateVendorConfig:async function(a){try{if(a=JSON.parse(a.vendor),a.version>x.configVersion){let b=await o({url:a.url,needToken:0}),c=b.body;x.configVersion<c.configVersion&&(x=c,i.writeFileSync(v,JSON.stringify(x)),w.emit('VENDOR_CONFIG_CHANGE',x),k.info(`updateVendorConfig end get new vendorConfig ${JSON.stringify(x)}`))}}catch(a){k.error(`updateVendorConfig catch error ${a}`)}return x}}}(require('lazyload'),require);