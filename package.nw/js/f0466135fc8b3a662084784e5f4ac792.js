'use strict';!function(require,directRequire){async function a(a){let g,p,s;a.tempProject?(g=a.tempProject.attr,p=a.tempProject):(g=o.getCurrentConfig(),p=o.getCurrent());try{const a=await m(p);s=a.subPackages?g.setting.MaxSubpackageFullCodeSize||g.setting.MaxCodeSize:g.setting.MaxCodeSize}catch(a){try{s=g.setting.MaxCodeSize}catch(a){s=2}}let u=1024*s;const v=a.onProgressUpdate||t;v('buildstart','\u6B63\u5728\u7F16\u8BD1\u4EE3\u7801');let w=await j(p,{noCompile:!0,onProgressUpdate:v,onFilesIgnored:a.onFilesIgnored});v('buildend','\u7F16\u8BD1\u4EE3\u7801\u5B8C\u6210'),v('packstart','\u6B63\u5728\u6253\u5305');let x=c.join(q,`${+new Date}.wx`),y=await k(w,x);b.unlink(x,()=>{}),v('packend','\u6253\u5305\u5B8C\u6210'),v('uploadstart','\u6B63\u5728\u4E0A\u4F20');let z=y.data,A=y.pDestPath;e(w,()=>{});let B=parseInt(y.totalSize/1024);if(B>u){let a=new Error(n.config.CODE_SIZE_EXCEED.format([B,u]));throw a.code=i.CODE_SIZE_EXCEED,a}let C,D=global.appConfig.isBeta;if(a.test){if(l[`last-up-test-${p.projectid}`]=B,C=D?`${h.testSourceNewFeatureURL}?gzip=1`:`${h.testSourceURL}?gzip=1`,a.remoteDebug){let b=1;'ios'===a.remoteDebugLocal?b=2:'android'===a.remoteDebugLocal&&(b=3);const c=a.remoteProxyPort||0,d=a.disableUrlCheck?1:0;C=`${h.testSourceURL}?gzip=1&open_remote=yes&remote_network_type=${b}&remote_proxy_port=${c}&disable_url_check=${d}`}let{page:b,query:c,searchQuery:d,boxQI:e}=a;if(b){let a=encodeURIComponent(`${b}?${c}`);C=`${C}&path=${a}`}if(d&&(C=`${C}&search_query=${encodeURIComponent(d)}`),e){C=`${C}&search_extInfo=${encodeURIComponent(JSON.stringify({box_qi:e}))}`}}else{l[`last-up-load-${p.projectid}`]=B;let b=encodeURIComponent(a.desc),c=encodeURIComponent(a.version),d=encodeURIComponent(a.uuid);C=D?`${h.commitSourceNewFeatureURL}?user-version=${c}&user-desc=${b}&uuid=${d}&gzip=1`:`${h.commitSourceURL}?user-version=${c}&user-desc=${b}&uuid=${d}&gzip=1`}let E=d.gzipSync(z);const F=1*new Date,G=a.tempProject?{url:`${C}&appid=${a.tempProject.appid}`,method:'post',body:E,needToken:1}:{url:C,method:'post',body:E,needToken:1,needAppID:1};let{body:H}=await f(G);const I=1*new Date;return r(a.test?'client_test_source_time':'client_commit_source_time',p.appid,`${I-F}`),v('uploadend','\u4E0A\u4F20\u5B8C\u6210'),H}const b=require('fs'),c=require('path'),d=require('zlib'),e=require('rmdir'),f=require('./15ba1827c7f6564a45df6bd44da3a977.js'),g=require('./92320c1386e6db6a6f2556736a9bc280.js'),h=require('./f171257bbcaef547a3cf27266ccb0db2.js'),i=require('./949d8235c744ced2a80121e4dba34c28.js'),j=require('./911222a6723da8db7ca8a8e3689591e1.js'),k=require('./e5fa35c3c8e81bc6466b4b8eb436113b.js'),l=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),m=require('./1dea83a77e99a7c94f6b6f01f5c175b0.js'),n=require('./common/locales/index.js'),o=require('./3bfffbe88b3d923921f851c0697974fe.js'),p=require('./72653d4b93cdd7443296229431a7aa9a.js'),q=g.Weappdest,r=require('./da7c31daaf542cf1796023d8e344b98a.js'),s=require('./a932aac82ac84fc9c6c92194bd88204e.js'),t=()=>{};module.exports=async function(b){return s.enqueueBuildTask(a.bind(null,b),s.buildType.upload)}}(require('lazyload'),require);