'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){async function a(a,b,c){const d=l.bind(null,a),e='weapp:///',f=JSON.parse(i.readFileSync(h.join(b,'app.json'),'utf8')),j=f.pages.map((a)=>{return a+'.js'}),m=k.sync('**/*.js',{cwd:b,ignore:['app.js',...j],nocase:!0,dot:!0});let n=await d('app.js'),o=[';'+n,';require("app.js");',`//# sourceURL=${e}app.js\n`].join('\n'),p=h.join(c,'app.js');g.sync(h.dirname(p)),i.writeFileSync(p,o,'utf-8');for(const f of j){const a=f.replace(/\.js$/i,'');n=await d(encodeURI(f)),o=[`;var __wxRoute = "${a.replace(/"/g,'\\"')}"; var __wxRouteBegin = true; var __wxAppCurrentFile__ ="${f.replace(/"/g,'\\"')}"; `+n,`;require("${f.replace(/"/g,'\\"')}");`,`//# sourceURL=${e}${f}\n`].join('\n'),p=h.join(c,f),g.sync(h.dirname(p)),i.writeFileSync(p,o,'utf-8')}for(const f of m)n=await d(encodeURI(f)),o=['var __wxAppData = __wxAppData || {}; var __wxRoute; var __wxRouteBegin; var __wxAppCode__ = __wxAppCode__ || {}; var global = global || {}; var __wxAppCurrentFile__; var Component = Component || function() {}; var Behavior = Behavior || function() {}; '+n,`//# sourceURL=${e}${f}\n`].join('\n'),p=h.join(c,f),g.sync(h.dirname(p)),i.writeFileSync(p,o,'utf-8');return[...m,'app.js',...j]}const{RemoteTempDir:b,RemoteDir:c,RemoteDataDir:d}=require('./a148d3a11fd5268109e21fb40c9d527b.js'),{commonError:e,randomId:f}=require('./46d7303eb986fa402d60bf5e929aa077.js'),g=require('mkdir-p'),h=require('path'),i=require('fs'),j=require('rmdir'),k=require('glob'),l=require('./87c0ac209c25d8bb448550638bb17663.js'),{RemoteDebug:m}=require('./6c6f4dde020ed24929c4c4367c42d34d.js'),{getState:n}=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js');let o=!1,p=[],q=[],r=null,s=!1;const t={getStatus(){return o&&!0!==o?{messager:{status:o.messager.status,inSpeed:o.messager.inSpeed,outSpeed:o.messager.outSpeed,outDebugMessageSpeed:o.messager.outDebugMessageSpeed,inDebugMessageSpeed:o.messager.inDebugMessageSpeed,outDebugMessageCount:o.messager.outDebugMessageCount,inDebugMessageCount:o.messager.inDebugMessageCount,inCount:o.messager.inCount,outCount:o.messager.outCount,inBytesCount:o.messager.inBytesCount,outBytesCount:o.messager.outBytesCount,sendQueueLength:o.messager.sendQueue.length,cachedDebugMessagesCount:o.messager.debugMessagesToSend.length,unconfirmedMessagesCount:(()=>{const a=o.messager.cachedDebugMessageSendGroups;let b=0;for(const c of a)b+=((c&&!c.confirmed&&c.sendDebugMessageRequest||{}).debug_message||[]).length;return b})()},_debugger:{status:o.debuggerStatus},dirs:{dir:o.dir,tempDir:o.tempDir},client:{deviceInfo:o.deviceInfo,networkType:o.clientNetworkType,networkSpeed:o.clientNetworkSpeed,networkInterval:o.clientNetworkInterval},currentSyncSdkName:(()=>{let a=o.currentSyncSdkName;if(!a&&o.syncCallIds){const b=Object.keys(o.syncCallIds);0<b.length&&(a=o.syncCallIds[b[0]])}return a})()}:null},subscribeChange(a){p.push(a)},subscribeEvent(a){q.push(a)},changeDebuggerStatus(a){o&&!0!==o&&o.changeDebuggerStatus(a)},onAskForRetry(a){r=a},endDebug(){o&&!0!==o&&o.destroy()}};module.exports={init:async function(i,k={},l={}){return new Promise(async(t,u)=>{if(o){console.warn('already an instance');const a=n();if(a&&a.window&&a.window.remoteDebugWindow&&!a.window.remoteDebugWindow.show){console.warn('shall be destroyed');try{o.destroy()}catch(a){}return o=null,u('\u8BF7\u91CD\u65B0\u5C1D\u8BD5\u4E00\u6B21\u3002')}return u(e('remote debug instance already exists'))}const v=f(),w=h.join(c,i.appid||v,v),x=h.join(b,i.appid||v,v),y=h.join(d,i.appid||v),z=()=>{try{j(w),j(x)}catch(a){}};try{o=!0;const{projectpath:b,miniprogramRoot:c}=i;g.sync(w),g.sync(x),g.sync(y);const d=h.join(b,c||''),e=await a(i,d,w);if(s)return s=!1,u('abort');o=new m({files:e,dir:w,tempDir:x,dataDir:y,initialRoomInfo:_extends({},k),config:_extends({},l)}),o.onAskForRetry((a)=>{return new Promise(async(b)=>{r?b((await r(a))):b(!1)})});let f;o.once('initsuccess',(a)=>{return s?(s=!1,o.destroy(),u('abort')):void(f=!0,t(_extends({},a)))}),o.once('initfail',(a)=>{s=!1,o&&(o.removeAllListeners(),o.destroy()),p=[],q=[],r=null,o=null,z(),f===void 0&&(f=!1,u(a))}),o.once('destroy',(a)=>{s=!1,o&&o.removeAllListeners(),o=null;for(const b of p)b();p=[],q=[],r=null,z(),f===void 0&&(f=!1,u(a))});let j;o.on('statuschange',()=>{j||(j=setTimeout(()=>{j=void 0;for(const a of p)a()},400))}),o.on('event',(a)=>{for(const b of q)b(a)}),await o.init()}catch(a){z(),o=null,u(e(a))}})},onUrlRequest:function(a){if(!o||!0===o)return void console.warn('no active instance');const b=a.replace(/^\/*remotedebug\/+/i,'').toLowerCase();switch(!0){case b.startsWith('registersyncpid/'):{const a=b.replace(/^\/*registersyncpid\/+/g,'');let[c,d]=a.split('/');if(c=parseInt(c,10),d=parseInt(d,10),isNaN(c)||isNaN(d))return void console.warn('invalid pid or sdkid');o.registerSyncPid(c,d);break}default:console.warn('invalid request href');}},destroy:function(){return!0===o?void(s=!0):void(!o||o.destroy())},model:t}}(require('lazyload'),require);