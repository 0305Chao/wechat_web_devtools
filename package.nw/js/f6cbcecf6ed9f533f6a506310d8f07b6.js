'use strict';!function(require,directRequire){function a(a){return a.replace(B,'').replace(C,'').replace(D,'')}function b(){let a=q.getUserInfo(),b=a?a.openid:'unknow';return b||''}function c(a,c){let d=a.appid,e=b();if(c||!E[`${d}_${e}`]){let a=j.join(A,e,d);(c||!k.existsSync(a))&&(m.sync(j.join(a,w)),m.sync(j.join(a,x)),m.sync(j.join(a,y))),E[`${d}_${e}`]=!0}}function d(a){return B.test(a)?w:C.test(a)?x:D.test(a)?y:z}function e(a,c,d){let e=a.appid,f=b(),g=l.createHash('md5');return c=c||`${Date.now()}`,g.update(c),`${e}.${f}.${g.digest('hex')}${d}`}function f(a){let c=a.appid,d=b();return j.join(A,d,c)}function g(c,e){let f=d(c);e=e||r.getCurrent();let g;if(f!==z){c=a(c);let d,h;d=e.appid||'',h=b();let i=j.join(A,h,d,f);if(i=i.endsWith('/')?i:i+'/',i=j.normalize(i),g=j.join(A,h,d,f,c),!g.startsWith(i))return{error:!0}}else{let a=e.miniprogramRoot,b=j.extname(c),d={".wxml":!0,".js":!0,".wxss":!0};if('mingganci'!==r.getCurrent().compileType&&(d['.json']=!0),!d[b]){let b;if(a?(b=j.join(e.projectpath,a),b=b.endsWith('/')?b:b+'/',b=j.normalize(b),g=j.join(e.projectpath,a,c)):(b=j.join(e.projectpath),b=b.endsWith('/')?b:b+'/',b=j.normalize(b),g=j.join(e.projectpath,c)),!g.startsWith(b))return{error:!0}}}return{error:!1,fileRealPath:g,type:f}}function h(a,c,d){let f=e(a,c,d),g=b(),h=j.join(A,g,a.appid,x,f);return k.writeFileSync(h,c),`${u}${f}`}function i(a,b){let c=g(b);if(c.type!==w)return{error:!0,reason:`permission denied, open ${b}`};let d=c.fileRealPath,e=j.dirname(d),f=!1;try{let a=k.lstatSync(e);f=a.isDirectory()}catch(a){}return f?{error:!1,realDirPath:e,fileRealPath:d}:{error:!0,reason:`no such file or directory ${b}`}}const j=require('path'),k=require('fs'),l=require('crypto'),m=require('mkdir-p'),n=require('glob'),o=require('rmdir'),p=require('adm-zip'),q=require('./89ba85d67a88f7636d657c22b5d3e038.js'),r=require('./3bfffbe88b3d923921f851c0697974fe.js'),{DATA_PATH:s,USER_DATA_PATH:t,TMP_DATA_PATH:u,STORE_DATA_PATH:v}=require('./37be435102276ea9cf47609ff6535cd4.js'),w='usr',x='tmp',y='store',z='package',{WeappFileSystem:A}=require('./92320c1386e6db6a6f2556736a9bc280.js'),B=new RegExp(`^${t+'/'}`),C=new RegExp(`^${u}`),D=new RegExp(`^${v}`);var E={},F={saveStoreFile:function(a,b){let c=a.appid,d=g(b);if(d.type===x){let a=d.fileRealPath;if(k.existsSync(a)){const b=k.lstatSync(a);if(b.isSymbolicLink())return{error:!0,reason:'tempFilePath is not a regular file'};let c=j.basename(a),d=k.readFileSync(a),e=j.join(a,'..','..',y,c);return k.writeFileSync(e,d),k.unlink(a,()=>{}),{error:!1,savedFilePath:`${v}${c}`}}}return{error:!0,reason:'tempFilePath file not exist'}},saveUsrFile:function(a,c,d){let e=a.appid,f=b(),h=g(d,a);if(h.type!==w)return{error:!0,reason:`permission denied, open "${d}"`};let i=h.fileRealPath,l=j.dirname(i),m=!1;try{let a=k.lstatSync(l);m=a.isDirectory()}catch(a){}if(!m)return{error:!0,reason:`no such file or directory "${j.dirname(d)}"`};let n=g(c);if(!k.existsSync(n.fileRealPath))return{error:!0,reason:`no such file or directory "${c}"`};const o=k.lstatSync(n.fileRealPath);if(o.isSymbolicLink())return{error:!0,reason:'tempFilePath is not a regular file'};let p=k.readFileSync(n.fileRealPath);return k.writeFileSync(i,p),{error:!1,savedFilePath:d}},copyFileToTemp:function(a,b,c){let d=k.readFileSync(b);return h(a,d,c)},copyFileDataToTemp:h,getUsrFileList:function(a){let c=b(),d=a.appid,e=j.join(A,c,d,y),f={},g=n.sync('**/**',{statCache:f,nodir:!0,stat:!0,cwd:e}),h=0;for(let b in f)h+=f[b].size;return{error:!1,fileList:g,totalSize:h}},getSavedFileList:function(a){let c=b(),d=a.appid,e=j.join(A,c,d,y),f=0,g={},h=n.sync('**/**',{statCache:g,nodir:!0,stat:!0,cwd:e}),i=h.map((a)=>{let b=g[j.join(e,a).replace(/\\/g,'/')];return f+=b.size,{filePath:`${v}${a}`,size:b.size,createTime:parseInt(b.ctime.getTime()/1e3)}});return{error:!1,fileList:i,totalSize:f}},readFile:function(a,b,c){let d=g(b),e=d.fileRealPath;if(!k.existsSync(e))return{error:!0,reason:`${b} not found`};const f=k.lstatSync(e);if(f.isSymbolicLink())return{error:!0,reason:`${b} is not a regular file`};let h=k.readFileSync(e,c);return{error:!1,fileData:h}},writeFile:function(a,b,c,d='utf8'){let e=i(a,b);if(e.error)return e;let f=e.fileRealPath;if(k.existsSync(f)){const a=k.lstatSync(f);if(a.isSymbolicLink())return{error:!0,reason:`${b} is not a regular file`};if(a.isDirectory())return{error:!0,reason:`illegal operation on a directory, open ${b}`}}return k.writeFileSync(f,c,d),{error:!1}},mkdir:function(a,b){let c=i(a,b);if(c.error)return c;let d=c.fileRealPath;return k.existsSync(d)?{error:!0,reason:`file already exists ${b}`}:(m.sync(d),{error:!1})},rmdir:function(a,c){let d=i(a,c);if(d.error)return d;let e=d.fileRealPath,f=d.realDirPath,g=b();if(f===j.join(A,g,a.appid))return{error:!0,reason:`permission denied, open ${c}`};if(!k.existsSync(e)||!k.lstatSync(e).isDirectory())return{error:!0,reason:`no such file or directory  ${c}`};let h=k.readdirSync(e).filter((a)=>{return 0!==a.indexOf('.')});return 0===h.length?(k.rmdirSync(e),{error:!1}):{error:!0,reason:`directory not empty`}},readdir:function(a,b){new RegExp(`^${t}/?$`).test(b)&&(b='http://usr/./');let c=i(a,b+'/');if(c.error)return c;let d=c.fileRealPath;if(!k.existsSync(d))return{error:!0,reason:`no such file or directory  ${b}`};if(!k.lstatSync(d).isDirectory())return{error:!0,reason:`not a directory  ${b}`};let e=k.readdirSync(d).filter((a)=>{return 0!==a.indexOf('.')});return{error:!1,files:e}},createTmpfileName:function(a,b){return`${u}${e(a,'',b)}`},initTmpfileName:function(a,b,c){return`${u}${e(a,b,c)}`},getFileSystemDir:f,unlink:function(a,b){let c=g(b,a);if(c.type===z)return{error:!0,reason:`fail permission denied, open "${b}"`};let d=c.fileRealPath;if(!k.existsSync(d))return{error:!0,reason:`fail no such file or directory "${b}"`};let e=k.lstatSync(d);if(e.isDirectory())return{error:!0,reason:`fail operation not permitted, unlink "${b}"`};try{k.unlinkSync(d)}catch(a){return{error:!0,reason:a.toString()}}return{error:!1}},stat:function(a,b){let c=g(b,a);if(c.type===z&&0===b.indexOf(s))return{error:!0,reason:`fail permission denied, open "${b}"`};let d=c.fileRealPath;if(!k.existsSync(d))return{error:!0,reason:`fail no such file or directory "${b}"`};let e=k.lstatSync(d);return{error:!1,mode:e.mode,size:e.size,lastAccessedTime:parseInt(e.atimeMs/1e3),lastModifiedTime:parseInt(e.mtimeMs/1e3)}},saveBase64DataToFile:function(a,c,d){let f=a.appid,g=b(),h=e(a,c,d);return k.writeFileSync(j.join(A,g,f,x,h),c,{encoding:'base64'}),{error:!1,tempFilePath:`${u}${h}`}},clearFileSystem:function(a){let b=f(a);o(b,()=>{c(a,!0)})},unzip:function(a,b,c){const d=g(b),e=d.fileRealPath;if(!e||!k.existsSync(e))return{error:!0,reason:`no such file or directory, open "${b}"`};const f=c;new RegExp(`^${t}/?$`).test(c)&&(c='http://usr/./');const h=g(c),i=h.fileRealPath;if(!i||h.type!==w)return{error:!0,reason:`permission denied, open "${f}"`};const l=j.dirname(i);if(!k.existsSync(l))return{error:!0,reason:`no such file or directory "${f}"`};const m=k.lstatSync(e);if(m.isSymbolicLink())return{error:!0,reason:`${b} is not a regular file`};try{const a=new p(e);a.extractAllTo(i,!0)}catch(a){return{error:!0,reason:'unzip failed'}}return{error:!1}}};Object.getOwnPropertyNames(F).forEach(function(a){const b=F[a];F[a]=function(){return c(arguments[0]),b.apply(F,arguments)}}),F.getFileRealPath=g,F.removeSavedFile=function(a){let b=g(a),c=b.fileRealPath;if(b.type===y&&k.existsSync(c)){try{k.unlinkSync(c)}catch(a){}return{error:!1}}return{error:!0,reason:'file not exist'}},F.getFileStat=function(a){let b=g(a),c=b.fileRealPath;try{let a=k.statSync(c);return{error:!1,size:a.size,createTime:parseInt(a.ctime.getTime()/1e3)}}catch(a){return{error:!0,reason:'file not found'}}},F.getFileInfo=function(a,b,c){let d=g(a);if(c&&d.type!==c)return{error:!0,reason:'file not find'};let e=d.fileRealPath;if(k.existsSync(e)){let c=k.lstatSync(e);if(c.isDirectory())return{error:!0,reason:`${a} is directory`};if(c.isSymbolicLink())return{error:!0,reason:`${a} is not a regular file`};let d=k.readFileSync(e),f='';if('md5'===b){let a=l.createHash('md5');a.update(d),f=a.digest('hex')}else if('sha1'===b){let a=l.createHash('sha1');a.update(d),f=a.digest('hex')}return{error:!1,size:c.size,digest:f}}return{error:!0,reason:'file not exist'}},F.isLocalId=function(a){return 0===a.indexOf(t+'/')||0===a.indexOf(u)||0===a.indexOf(v)},F.USR='usr',F.TMP='tmp',F.STORE='store',F.PACKAGE='package',module.exports=F}(require('lazyload'),require);