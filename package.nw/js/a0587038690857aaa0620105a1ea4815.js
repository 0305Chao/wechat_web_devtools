'use strict';!function(require,directRequire){function a(a){let b=window.atob(a),c=b.length,d=new Uint8Array(c);for(let e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer}function b(a){let b=new Buffer(a.byteLength),c=new Uint8Array(a);for(let d=0;d<b.length;++d)b[d]=c[d];return b}async function c(a,b){let c=b.args,d=c.tempFilePath,e=c.filePath,f=u.getFileStat(d);if(!f)return{errMsg:`${b.api}:fail file not found`};const g=o.getCurrentConfig(),h=g.setting.MaxFileStorageSize,i=o.getCurrent();let j=u.getSavedFileList(i),k=u.getUsrFileList(i);if(1024*(1024*h)<j.totalSize+k.totalSize+f.size)return{errMsg:`${b.api}:fail exceeded the maximum size of the file storage limit ${h}M`};let l;return e?e&&(l=u.saveUsrFile(i,d,e)):l=u.saveStoreFile(i,d),l.error?{errMsg:`${b.api}:fail ${l.reason}`}:{errMsg:`${b.api}:ok`,savedFilePath:l.savedFilePath}}async function d(a,b){let c=b.args,d=c.filePath,e=c.encoding,f=o.getCurrent(),g=u.readFile(f,d,e);if(g.error)return{errMsg:`${b.api}:fail ${g.reason}`};let h=g.fileData,i={errMsg:`${b.api}:ok`};return e?i.data=h.toString():(i.base64=h.toString('base64'),i.__cover={base64:'data'}),i}async function e(c,d){let e=d.args,f=e.filePath,g=e.data||'',h=e.encoding||'utf8',i=e.__dataisab;i?(g=a(g),g=b(g)):g=g;let j=o.getCurrent();const k=o.getCurrentConfig(),l=k.setting.MaxFileStorageSize;let m=u.getSavedFileList(j),n=u.getUsrFileList(j);if(1024*(1024*l)<m.totalSize+n.totalSize+g.length)return{errMsg:`${d.api}:fail exceeded the maximum size of the file storage limit ${l}M`};let p=u.writeFile(j,f,g,h);return p.error?{errMsg:`${d.api}:fail ${p.reason}`}:{errMsg:`${d.api}:ok`}}async function f(a,b){let c=b.args,d=c.dirPath,e=o.getCurrent(),f=u.mkdir(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`}}async function g(a,b){let c=b.args,d=c.dirPath,e=o.getCurrent(),f=u.rmdir(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`}}async function h(a,b){let c=b.args,d=c.dirPath,e=o.getCurrent(),f=u.readdir(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`,files:f.files}}async function i(a,b){let c=b.args,d=c.path,e=o.getCurrent(),f=u.getFileRealPath(d,e);return l.existsSync(f.fileRealPath)?{errMsg:`${b.api}:ok`}:{errMsg:`${b.api}:fail no such file or directory, access "${d}"`}}async function j(a,b){let c=b.args,d=c.filePath,e=o.getCurrent(),f=u.unlink(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`}}async function k(a,b){let c=b.args,d=c.path,e=o.getCurrent(),f=u.stat(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`,mode:f.mode,size:f.size,lastAccessedTime:f.lastAccessedTime,lastModifiedTime:f.lastModifiedTime}}const l=require('fs'),m=require('path'),n=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),o=require('./3bfffbe88b3d923921f851c0697974fe.js'),p=require('crypto'),{enterBackground:q,enterForeground:r}=require('./a3959bb900db9f65ed2e9c5dfa6977b7.js'),s=require('mkdir-p'),t=require('rmdir'),u=require('./f6cbcecf6ed9f533f6a506310d8f07b6.js'),v={".doc":!0,".xls":!0,".ppt":!0,".pdf":!0,".docx":!0,".xlsx":!0,".pptx":!0};module.exports={saveFile:c,saveFileSync:c,openDocument:async function(a,b){let c=b.args,{filePath:d,fileType:e}=c;1004000>o.getLibVersionNumber()&&(e='');let f=!1;if(!e){let a=m.extname(d).toLowerCase();f=!v[a]}else f=!v[`.${e}`];if(f)return{errMsg:`${b.api}:fail filetype not supported`};let g=u.getFileRealPath(d),h=g.fileRealPath;if(!l.existsSync(h))return{errMsg:`${b.api}:fail file not exist'`};if(q('openDocument'),e){let a=l.readFileSync(h);h=`${h}.${e}`,l.writeFileSync(h,a),nw.Shell.openItem(h)}else nw.Shell.openItem(h);return setTimeout(()=>r('openDocument'),200),{errMsg:`${b.api}:ok`}},getSavedFileList:async function(a,b){let c=o.getCurrent(),d=u.getSavedFileList(c);return{errMsg:`${b.api}:ok`,fileList:d.fileList}},getSavedFileInfo:async function(a,b){let c=b.args,d=u.getFileInfo(c.filePath,'','store');return d.error?{errMsg:`${b.api}:fail ${d.reason}`}:{errMsg:`${b.api}:ok`,size:d.size,createTime:d.createTime}},getFileInfo:async function(a,b){let c=b.args,d=c.filePath,e=c.digestAlgorithm||'md5',f=u.getFileInfo(d,e);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`,size:f.size,digest:f.digest}},removeSavedFile:async function(a,b){let c=b.args,d=u.removeSavedFile(c.filePath);return d.error?{errMsg:`${b.api}:fail ${d.reason}`}:{errMsg:`${b.api}:ok`}},base64ToTempFilePath:async function(a,b){let c=b.args;if(c.base64Data){let a=o.getCurrent(),d=u.saveBase64DataToFile(a,c.base64Data,'.png');if(!d.error)return{errMsg:`${b.api}:ok`,tempFilePath:d.tempFilePath}}return{errMsg:`${b.api}:fail`}},readFile:d,readFileSync:d,writeFile:e,writeFileSync:e,mkdir:f,mkdirSync:f,rmdir:g,rmdirSync:g,readdir:h,readdirSync:h,access:i,accessSync:i,unlink:j,unlinkSync:j,stat:k,statSync:k,unzip:async function(a,b){const c=b.args,d=c.zipFilePath,e=c.targetDirectory||'http://usr',f=o.getCurrent(),g=u.unzip(f,d,e);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`}}}}(require('lazyload'),require);