'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){const a=require('react'),b=require('react-dom'),c=require('./cf139c99bcbda6ce0fa4054b089e2335.js'),{model:d}=require('./63f52c9055d92f52ca0510da7d3dcadb.js'),{safeFormatSize:e,titleForEvent:f}=require('./96268d17c4410f0083b6c98f5e34acff.js'),g=(global.appConfig||{}).isDev;module.exports=class extends a.Component{constructor(){super(),this.state={events:[],askingForRetry:!1,retryCount:0,plain:'',inspectMode:!1}}onAskForRetry(a){return new Promise((b)=>{this._askingForRetryResolver=b,this.setState({askingForRetry:!0,retryCount:a})})}handleAskingForRetryResult(a){this.setState({askingForRetry:!1}),this._askingForRetryResolver&&(this._askingForRetryResolver(!!a),this._askingForRetryResolver=null)}handleUsingLocalStorageCheckboxChange(){const a=!!!this.props.remote.usingLocalStorage;!!a!==!!this.props.remote.usingLocalStorage&&this.props.changeUsingLocalStorage&&(this.props.changeUsingLocalStorage(a),this.setState({settingsTipsShow:!0}))}handleDisableUrlCheckCheckboxChange(){const a=!!!this.props.remote.disableUrlCheck;!!a!==!!this.props.remote.disableUrlCheck&&this.props.changeDisableUrlCheck&&(this.props.changeDisableUrlCheck(a),this.setState({settingsTipsShow:!0}))}componentDidMount(){d.subscribeChange((a)=>{this.onStatusChange(a)}),d.subscribeEvent((a)=>{a=a||{};const b=[{event:{kind:a.kind,type:f(a),message:a.message},timestamp:new Date},...this.state.events];this.setState({events:b})}),d.onAskForRetry(this.onAskForRetry.bind(this)),d.onOpenEditorFile(this.openEditorFile.bind(this)),this.onStatusChange();const a=b.findDOMNode(this.container);if(!a)return;let c,e;c=this.webview=document.createElement('webview'),c.setAttribute('partition','persist:devtools'),c.src='about:blank',a.appendChild(c);const g=()=>{c.removeEventListener('loadcommit',g),c.addEventListener('dialog',(a)=>{a.preventDefault();const b=a.messageType,c=a.messageText,e=a.dialog;if('alert'===b)if(e&&e.ok(),0<=c.indexOf('debugger:paused'))d.changeDebuggerStatus(1);else if(0<=c.indexOf('debugger:resumed'))d.changeDebuggerStatus(0);else if(0<=c.indexOf('opennewtab:')){const a=c.replace('opennewtab:','');this.handleNewWindow(a)}})},h=()=>{e.removeEventListener('loadcommit',h),e.showDevTools(!0,c);const a=`${c.getUserAgent()} remotedebugdevtools ${this.props.remote.usingLocalStorage?'usinglocalstorage':''} port/${global.messageCenterPort}`;c.setUserAgentOverride(a),c.src=`${this.props.remote.inspectUrl}`,c.setAttribute('style','position: relative; width: 100%; height: 100%; margin: 0 auto;'),c.addEventListener('loadcommit',g),e.parentNode.removeChild(e)},i=()=>{c.removeEventListener('loadcommit',i),e=document.createElement('webview'),e.style.visibility='hidden',e.src='about:blank',a.parentNode.insertBefore(e,a),e.addEventListener('loadcommit',h)};c.addEventListener('loadcommit',i)}componentWillUnmount(){}async openEditorFile(a){let b=this.props.project,c=b.miniprogramRoot?path.posix.join(b.projectpath,b.miniprogramRoot):b.projectpath,d=path.posix.relative(b.projectpath,path.posix.join(c,a.file));this.props.openEditorFile&&this.props.openEditorFile({file:`/${d}`,line:parseInt(a.line)})}onStatusChange(a){let b=d.getStatus();if((!b||a)&&(b={messager:{status:-1}}),this.setState(_extends({},this.state,b)),this.webview)if(b.currentSyncSdkName){const a=b.currentSyncSdkName;this.webview.executeScript({code:`(function() { try {
            var line = document.querySelector("#console-prompt .CodeMirror-lines[role='presentation']");
            line.setAttribute("data-sdkname", "${a}")
            line.classList.add("__sync");
          } catch(e) { } })();`})}else a?this.webview.src='html/debugger-end.html':this.webview.executeScript({code:`(function() { try {
            var line = document.querySelector("#console-prompt .CodeMirror-lines[role='presentation']");
            line.setAttribute("data-sdkname", "")
            line.classList.remove("__sync");
          } catch(e) { } })();`})}handleTmpClick(){nw.Shell.openItem(this.state.dirs.tempDir)}handleDirClick(){nw.Shell.openItem(this.state.dirs.dir)}handleFinishClick(){d.endDebug()}handleOuterClick(){document.activeElement.blur()}handleErrorsClear(){this.setState({events:[]})}handleToggleSection(a){const b=[...(this.state.foldedSections||[])];b[a]=!b[a],this.setState({foldedSections:b})}handleNewWindow(a){function b(a){try{nw.Window.open(a,{width:799,height:799})}catch(a){}}0===a.indexOf(`http://127.0.0.1:${global.proxyPort}/appservice/appservice`)||`http://127.0.0.1:${global.proxyPort}/favicon.ico`===a||0===a.indexOf('ws://')||0===a.indexOf('wss://')||a&&('https://developers.google.com/web/tools/chrome-devtools/'===a?(a='https://mp.weixin.qq.com/debug/wxadoc/dev/index.html',b(a)):'https://developers.google.com/web/updates/2017/05/devtools-release-notes'===a?(a='https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/new.html',b(a)):0==a.indexOf('wxfile://')?(a=a.replace('wxfile://','http://wxfile.open.weixin.qq.com/'),function(a){try{nw.Window.open(a,{width:799,height:799})}catch(a){}}(a)):b(a))}handleInspectModeChange(){var a=!this.state.inspectMode;this.setState({inspectMode:a});const b=d.getInstance();a?(c.send({command:'SHOW_PANNEL',data:{name:'Wxml'}}),b&&b.setInspectMode('searchForNode')):b&&b.setInspectMode('none')}render(){try{`data:image/png;base64,${this.props.remote.serverInfo.qrcode_img}`}catch(a){}const{messager:b={},_debugger:c={},dirs:d={},client:f={},syncCallIds:h={}}=this.state;f.deviceInfo=f.deviceInfo||{};const i=this.state.foldedSections||[];return a.createElement('div',{onClick:this.handleOuterClick.bind(this),className:'container'},a.createElement('div',{className:'debugger',ref:(a)=>this.container=a},a.createElement('div',{id:'mask',style:{display:this.state.askingForRetry?'block':'none'}})),a.createElement('div',{className:'detail'},a.createElement('div',{className:'detail-bd'},a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd',onClick:this.handleToggleSection.bind(this,0)},a.createElement('h3',null,f.deviceInfo.device_name||'\u8FDC\u7A0B\u8BBE\u5907\u4FE1\u606F')),!i[0]&&a.createElement('div',{className:'section-bd'},a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u624B\u673A\u578B\u53F7'),a.createElement('p',{className:'value'},f.deviceInfo.device_model||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u8FD0\u884C\u7CFB\u7EDF'),a.createElement('p',{className:'value'},f.deviceInfo.os||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u5FAE\u4FE1\u7248\u672C'),a.createElement('p',{className:'value'},f.deviceInfo.wechat_version||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u57FA\u7840\u5E93\u7248\u672C'),a.createElement('p',{className:'value'},f.deviceInfo.displayPublib||f.deviceInfo.publib||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u5F80\u8FD4\u8017\u65F6'),a.createElement('p',{className:'value'},(()=>{return f.networkInterval&&isFinite(f.networkInterval)?600<f.networkInterval?a.createElement('span',{style:{fontWeight:'600',color:'red'}},f.networkInterval+'ms'):f.networkInterval+'ms':'-'})())),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u8FDE\u63A5\u65B9\u5F0F'),a.createElement('p',{className:'value'},(()=>{const b=f.networkType;if('number'!=typeof b)return'-';return 0===b?a.createElement('span',{style:{color:'red',fontWeight:'600'}},'\u672A\u8FDE\u63A5'):1===b?'2G':2===b?'3G':3===b?'4G':4===b?'Wi-Fi':-1===b?'\u6570\u636E\u7EBF (Android)':-2===b?'\u6570\u636E\u7EBF (iOS)':'\u5176\u4ED6'})())))),a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd',onClick:this.handleToggleSection.bind(this,1)},a.createElement('h3',null,'\u8FDE\u63A5\u4FE1\u606F')),!i[1]&&a.createElement('div',{className:'section-bd'},a.createElement('div',{className:'meta '+(2>b.status?'meta-warn':'')},a.createElement('label',{className:'key'},'\u8FDE\u63A5\u72B6\u6001'),a.createElement('p',{className:'value'},(()=>{const c=b.status;return-1===c?a.createElement('span',{style:{color:'red',fontWeight:'600'}},'\u5DF2\u7ED3\u675F'):0===c?a.createElement('span',{style:{fontWeight:'600'}},'\u672A\u521D\u59CB\u5316'):1===c?a.createElement('span',{style:{fontWeight:'600'}},'\u672A\u8FDE\u63A5'):2===c?a.createElement('span',{style:{fontWeight:'600'}},'\u5DF2\u767B\u51FA'):3===c?a.createElement('span',{style:{fontWeight:'600'}},'\u6B63\u5728\u767B\u9646'):4===c?'\u7B49\u5F85\u8BBE\u5907':5===c?a.createElement('span',{style:{fontWeight:'600'}},'\u670D\u52A1\u5668\u963B\u585E'):6===c?'\u7B49\u5F85\u56DE\u5305':7===c?'\u6B63\u5E38':a.createElement('span',{style:{color:'red',fontWeight:'600'}},'\u672A\u77E5')})()),7>=b.status&&4<=b.status?a.createElement('div',{className:'ext'},a.createElement('i',{className:'ui-icon-circle'})):null),a.createElement('div',{className:'meta '+(2>b.status?'meta-warn':'')},a.createElement('label',{className:'key'},'\u670D\u52A1\u72B6\u6001'),a.createElement('p',{className:'value'},(()=>{const c=b.status;return-1===c||0===c||1===c?a.createElement('span',{style:{fontWeight:'600'}},'\u672A\u8FDE\u63A5'):2===c||3===c||4===c?'\u6B63\u5E38':5===c?a.createElement('span',{style:{fontWeight:'600'}},'\u670D\u52A1\u5668\u963B\u585E'):6===c||7===c?'\u6B63\u5E38':'\u672A\u77E5'})()),7>=b.status&&a.createElement('div',{className:'ext'},a.createElement('i',{className:'ui-icon-circle'}))),g&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u5DF2\u53D1\u9001'),a.createElement('p',{className:'value'},e(b.outBytesCount))),g&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u5DF2\u63A5\u6536'),a.createElement('p',{className:'value'},e(b.inBytesCount))),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u6D41\u91CF'),a.createElement('p',{className:'value'},e(b.inBytesCount+b.outBytesCount))),0<b.compressionSavedBytes?a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u538B\u7F29\u8282\u7701'),a.createElement('p',{className:'value'},e(b.compressionSavedBytes))):null,a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u6536\u5230\u4FE1\u606F'),a.createElement('p',{className:'value'},b.inDebugMessageCount||0)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u53D1\u51FA\u4FE1\u606F'),a.createElement('p',{className:'value'},b.outDebugMessageCount||0)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u53D1\u9001\u6548\u7387'),a.createElement('p',{className:'value'},(b.outDebugMessageSpeed||0)+' \u4E2A/\u79D2')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u63A5\u6536\u6548\u7387'),a.createElement('p',{className:'value'},(b.inDebugMessageSpeed||0)+' \u4E2A/\u79D2')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u7B49\u5F85\u53D1\u9001'),a.createElement('p',{className:'value'},b.cachedDebugMessagesCount||0)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u672A\u786E\u8BA4'),a.createElement('p',{className:'value'},b.unconfirmedMessagesCount||0)),g&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u53D1\u51FA\u5305'),a.createElement('p',{className:'value'},b.outCount||0)),g&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},'\u6536\u5230\u5305'),a.createElement('p',{className:'value'},b.inCount||0)))),this.state.askingForRetry||0<this.state.events.length?a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd'},a.createElement('h3',null,'\u8B66\u544A\u548C\u9519\u8BEF'),a.createElement('div',{className:'section-hd-extra',onClick:this.handleErrorsClear.bind(this)},a.createElement('i',{className:'ui-icon-circle-x'}),a.createElement('span',null,this.state.events.length||0))),a.createElement('div',{className:'section-bd section-bd-warn'},this.state.askingForRetry?a.createElement('div',{className:'msg-area'},a.createElement('div',{className:'msg-text-area'},a.createElement('p',null,a.createElement('i',{className:'ui-icon-error'}),'\u8FDE\u63A5\u65AD\u5F00\uFF0C\u662F\u5426\u91CD\u8FDE\uFF1F')),a.createElement('div',{className:'msg-button-area'},a.createElement('button',{className:'ui-button ui-button-primary',onClick:this.handleAskingForRetryResult.bind(this,!0)},'\u91CD\u65B0\u8FDE\u63A5'))):null,this.state.events.map((b,c)=>{return b&&b.event&&b.event.type?a.createElement('div',{className:'msg '+(b.event.kind?'error-'+b.event.kind:''),key:c},'error'===b.event.kind?a.createElement('i',{className:'ui-icon-circle-x'}):null,a.createElement('p',null,(b.timestamp||new Date).toLocaleTimeString()),a.createElement('p',null,'\u7C7B\u578B\uFF1A',b.event.type),b.event.message&&a.createElement('p',null,'\u8BE6\u60C5\uFF1A',b.event.message)):null}))):null,a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd',onClick:this.handleToggleSection.bind(this,3)},a.createElement('h3',null,'\u8BBE\u7F6E')),!i[3]&&a.createElement('div',{className:'section-bd'},a.createElement('label',{htmlFor:'',className:'ui-checkbox',onClick:this.handleUsingLocalStorageCheckboxChange.bind(this)},a.createElement('i',{className:this.props.remote.usingLocalStorage?'ui-icon-checkbox-o':'ui-icon-checkbox'}),a.createElement('span',{className:'ui-checkbox-text'},'\u4F7F\u7528\u5DE5\u5177\u7AEF\u7684 Storage')),a.createElement('label',{htmlFor:'',className:'ui-checkbox',style:{margin:'10px 0'},onClick:this.handleDisableUrlCheckCheckboxChange.bind(this)},a.createElement('i',{className:this.props.remote.disableUrlCheck?'ui-icon-checkbox-o':'ui-icon-checkbox'}),a.createElement('span',{className:'ui-checkbox-text'},'\u4E0D\u6821\u9A8C\u5408\u6CD5\u57DF\u540D\u3001web-view\uFF08\u4E1A\u52A1\u57DF\u540D\uFF09\u3001TLS \u7248\u672C\u4EE5\u53CA HTTPS \u8BC1\u4E66')),this.state.settingsTipsShow&&a.createElement('p',{className:'option',style:{color:'#999',fontSize:'12px',marginLeft:'25px',marginBottom:'25px'}},'\u4E0B\u6B21\u8C03\u8BD5\u751F\u6548'),122<=f.deviceInfo.publib&&a.createElement('label',{htmlFor:'',className:'ui-checkbox',onClick:this.handleInspectModeChange.bind(this)},a.createElement('i',{className:this.state.inspectMode?'ui-icon-checkbox-o':'ui-icon-checkbox'}),a.createElement('span',{className:'ui-checkbox-text'},'\u8282\u70B9\u5BA1\u67E5\u6A21\u5F0F'))))),a.createElement('div',{className:'detail-ft'},a.createElement('a',{className:'hero',onClick:this.handleFinishClick.bind(this)},'\u7ED3\u675F\u8C03\u8BD5'))))}}}(require('lazyload'),require);