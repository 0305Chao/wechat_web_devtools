'use strict';!function(require,directRequire){function a(){o=void 0}function b(b,c){let d=g.extname(c);'.json'===d&&a()}async function c(c){let d=await l(c);p&&p.srcPath==d.srcPath||(a(),p&&p.unWatch(b),p=d,p.watch(b)),q!=c.compileType&&(a(),q=c.compileType)}async function d(a,b){let c='plugin.json',d={};if(b.publicComponents){if('object'!=i.getType(b.publicComponents)){let a=new Error(j.config.JSON_CONTENT_SHOULD_BE.format(['publicComponents','Object']));throw a.code=m.PLUGIN_JSON_CONTENT_ERR,a}let f=[];for(let i in b.publicComponents){let k=b.publicComponents[i];await e(k,`publicComponents['${i}']`),h.existsSync(g.join(a,`${k}\.wxml`))||f.push(j.config.JSON_PAGE_FILE_NOT_EXISTS.format([c,'publicComponents',k,'WXML'])),h.existsSync(g.join(a,`${k}\.js`))||f.push(j.config.JSON_PAGE_FILE_NOT_EXISTS.format([c,'publicComponents',k,'JS'])),h.existsSync(g.join(a,`${k}\.json`))||f.push(j.config.JSON_PAGE_FILE_NOT_EXISTS.format([c,'publicComponents',k,'JSON'])),d[i]=!0}if(0<f.length){let a=new Error(f.join('\n'));throw a.code=m.PLUGIN_JSON_FILE_NOT_FOUND,a}}if(b.pages){if('object'!=i.getType(b.pages)){let a=new Error(j.config.JSON_CONTENT_SHOULD_BE.format(['pages','Object']));throw a.code=m.PLUGIN_JSON_CONTENT_ERR,a}let f=[];for(let i in b.pages){let k=b.pages[i];await e(k,`pages['${i}']`),h.existsSync(g.join(a,`${k}\.wxml`))||f.push(j.config.JSON_PAGE_FILE_NOT_EXISTS.format([c,'pages',k,'WXML'])),h.existsSync(g.join(a,`${k}\.js`))||f.push(j.config.JSON_PAGE_FILE_NOT_EXISTS.format([c,'pages',k,'JS'])),h.existsSync(g.join(a,`${k}\.json`))||f.push(j.config.JSON_PAGE_FILE_NOT_EXISTS.format([c,'pages',k,'JSON'])),d[i]&&f.push(`pages 与 publicComponents 不能存在相同的 key:${i}`),d[i]=!0}if(0<f.length){let a=new Error(f.join('\n'));throw a.code=m.PLUGIN_JSON_FILE_NOT_FOUND,a}}}async function e(a,b){for(var c=['.','/',' ','\\'],d=0,e=c.length;d<e;d++){let e=c[d];if(0==a.indexOf(e)){let a=new Error(j.config.JSON_SHOULD_NOT_START_WITH.format([b,e]));throw a.code=m.PLUGIN_JSON_CONTENT_ERR,a}}}async function f(a,b){if(b.main){if('string'!=i.getType(b.main)){let a=new Error(j.config.JSON_CONTENT_SHOULD_BE.format(['main','string']));throw a.code=m.PLUGIN_JSON_CONTENT_ERR,a}if(await e(b.main,'main'),!h.existsSync(g.join(a,b.main))){let a=new Error(j.config.JSON_PAGE_FILE_NOT_EXISTS.format(['plugin.json','main',b.main,'JS']));throw a.code=m.PLUGIN_JSON_FILE_NOT_FOUND,a}}}const g=require('path'),h=require('fs'),i=require('./84b183688a46c9e2626d3e6f83365e13.js'),j=require('./common/locales/index.js'),k=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),l=require('./a63026ab5a5a3c59a61a9749a18aa2ca.js'),m=require('./949d8235c744ced2a80121e4dba34c28.js'),n=require('./6238a86bb7a55c11aa0f9eb335d0f34c.js');var o=void 0,p=void 0,q=void 0;module.exports=async function(a){let b=a.compileType;if(b!=k.plugin)return{};if(await c(a),!o){let a=p.srcPath,b='plugin.json',c='';try{c=p.getFile(b)}catch(a){let c=new Error(j.config.FILE_NOT_FOUND.format(b));throw c.code=m.PLUGIN_JSON_READ_ERR,c.ext=a.toString(),c}let e={};try{e=JSON.parse(c)}catch(a){let b=n.parseJsonParseErr({data:c});throw a=new Error(b),a.code=m.PLUGIN_JSON_PARSE_ERR,a}await d(a,e),await f(a,e),o=e}return o}}(require('lazyload'),require);