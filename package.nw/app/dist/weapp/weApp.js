'use strict';var _exports={};function init(){const a=global.appConfig.isDev,{JSON_PARSE_ERROR:b,ES6_ERROR:c,JSON_FILE_ERROR:d,JSON_ENTRANCE_ERROR:f,JSON_CONTENT_ERROR:g}=require('../config/config.js'),h=require('./trans/transManager.js'),j=require('./utils/tools.js');require('async');const k=require('fs'),l=require('path'),m=require('url'),n=require('./utils/vendorManager.js');require('glob');const o=require('./utils/projectManager.js'),p=require('../config/appserviceConfig.js'),q=require('../stores/projectStores.js'),r=require('../stores/windowStores.js'),s=require('../actions/windowActions.js'),t=require('./utils/parseErr.js'),u=require('../utils/file.js');require('./tpl/errorTpl.js'),require('./tpl/appserviceErrorTpl.js');const v=l.join(__dirname,'appservice/asdebug.js');var w=k.readFileSync(v,'utf8');j.noBrowser.join(','),_exports.getAppservice=function(x,y){let z=j.getProject(x),A=m.parse(x),B=A.pathname,C=/appservice$/.test(B),D=/appservice-sdk\.js$/.test(B),E=/asdebug\.js$/.test(B),F=/ascheck\.js$/.test(B),G=/webnode\.js$/.test(B),H=/reporter-sdk\.js/.test(B),I=/app_service_engine\.js/.test(B);/\.js$/.test(B);let J=/\.js\.map$/.test(B),K=/WAService\.js/.test(B),L=/favicon\.ico$/.test(B),M=/hls\.js/.test(B);if(L)y(200,{},'');else if(K)y(null,{},n.getFile('WAService.js'));else if(H)y(null,{},n.getFile('reporter-sdk.js'));else if(I)y(null,{},n.getFile('app_service_engine.js'));else if(D)y(null,{},n.getFile('appservice-sdk.js'));else if(M)y(null,{},n.getFile('hls.js'));else if(E)y(null,{},w);else if(F)y(null,{},asCheck);else if(G)y(null,{},n.getFile('webnode.js'));else if(J){let N=l.join(z.projectpath,B);k.readFile(N,(O,P)=>{return O?void y(404,{},`do not find ${N}`):void y(200,{},P)})}else{z.appname.toLowerCase(),z.appid.toLowerCase();let N=z.hash,O;try{O=o.getAppConfigJSONSync(z)}catch(R){return y(200,{},''),void setTimeout(()=>{let T,S=R.type;S===b?T=t.parseJsonParseErr(R):S===d?T=t.parseJsonFileErr(R):S===f?T=t.parseJsonEntranceErr(R):S===g&&(T=t.parseJsonContentErr(R)),s.showWeappError(R.type,T)},200)}let P=q.getProjectConfig(z);O.projectConfig=P,O.appserviceConfig=p;let Q=O.pages||[];if(C){let R=require('./tpl/appserviceTpl.js'),S=`http://${N}.appservice.open.weixin.qq.com/`,T=[],U=[],V=[];o.getAllJSFileList(z,(W,X)=>{let Y={};for(let Z=0,$=Q.length;Z<$;Z++){let _=`${Q[Z]}.js`;Y[_]=!0,T.push(`<script>__wxRoute = '${Q[Z]}';__wxRouteBegin = true</script>`),T.push(`<script src="${S}${_}"></script>`),T.push(`<script>
              if(__wxRouteBegin) {
                console.group("${new Date} page 编译错误")
                console.error(\` ${Q[Z]} 出现脚本错误或者未正确调用 Page()\`)
                console.groupEnd()
              }
              </script>`)}for(let Z=0,$=X.length;Z<$;Z++){let _=X[Z];Y[_]||('app.js'===_?V.push(`<script src="${S}${_}"></script>`):U.push(`<script src="${S}${_}"></script>`))}T=U.concat(V).concat(T),a?(T.unshift(`<script src="${S}app_service_engine.js"></script>`),T.unshift(`<script src="${S}appservice-sdk.js"></script>`),T.unshift(`<script src="${S}reporter-sdk.js"></script>`),T.unshift(`<script src="${S}webnode.js"></script>`)):T.unshift(`<script src="${S}WAService.js"></script>`),T.unshift(`<script src="${S}asdebug.js"></script>`),O.app_nickname=z.app_nickname||z.appname,O.appname=z.appname,O.appid=z.appid,O.apphash=z.hash,O.isTourist=z.isTourist,O.platform='devtools',z.isTourist&&(O.userInfo=r.getUserInfo()),O.urlCheck=z.urlCheck,T.unshift(`<script>var __wxConfig = ${JSON.stringify(O)}</script>`),R=R.replace('<script></script>',T.join('')),y(null,{},R)})}else{let R=x.replace(`http://${N}.appservice.open.weixin.qq.com/`,'');o.getScripts({project:z,fileName:R,needRequire:'app.js'===R||-1!==Q.indexOf(R.replace(/\.js/,''))},(S,T)=>{if(!S)y(null,{'Content-Type':'text/javascript; charset=UTF-8'},T);else if(!T)S.project=z,s.showWeappError(S.type,t.parseJsFileErr(S)),y(200,{},'');else{let U={file:S.sourceFileName,msg:S.msg};y(null,{[c]:encodeURIComponent(JSON.stringify(U))},T)}})}}},_exports.getLocalIdResponse=function(x,y){if(u.isAppTmpPath(x)){let z=u.getRealPath(x);k.readFile(z,(A,B)=>{A?y(404,{'Weapp-Error':encodeURIComponent(A)},A.toString()):y(null,{},B)})}else y(404,{},`do not find ${x}`)},_exports.getResponse=function(x,y){h.getResponse(x,y)}}init(),module.exports=_exports;